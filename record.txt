simulation_mutral_Detection


### PARAMETER SELECTION #############################################################################################################
matplotlib.rcParams['pdf.fonttype'] = 42
matplotlib.rcParams['ps.fonttype'] = 42
np.random.seed(1)

T = 10
dt = 1

A_0 = np.block([[np.zeros([2, 2]), np.eye(2)], [np.zeros([2, 2]), np.zeros([2, 2])]])
B_0 = np.block([[np.zeros([2, 2])], [np.eye(2)]])
A = sp.linalg.expm(A_0 * dt)
B = np.sum([np.linalg.matrix_power(A_0 * dt, i) / math.factorial(i + 1) for i in np.arange(100)], axis=0).dot(B_0)
C = np.block([[np.eye(2), np.zeros([2, 2])]])

C_test = np.array([
    [1, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 0, 0, 0],
    [0, 1, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 1, 0, 0],
])

A_joint = sp.linalg.block_diag(A, A)
B_joint = sp.linalg.block_diag(B, B)
C_joint = C_test

A_list = (T + 1) * [A_joint]
B_list = (T + 1) * [B_joint]
C_list = (T + 1) * [C_joint]

max_v1 = 2
max_v2 = 4
max_x0 = 1
max_v0 = 0
box_x = 15

comm_dist = 12

center_times_uav1 = (T + 1) * [[0, 0, 0, 0]]
center_times_uav2 = (T + 1) * [[0, 0, 0, 0]]
radius_times_uav1 = (T + 1) * [[box_x, box_x, max_v1, max_v1]]
radius_times_uav2 = (T + 1) * [[box_x, box_x, max_v2, max_v2]]

box_check = [0,10]

center_times_uav1[box_check[0]] = [-5, 4, 0, 0]
radius_times_uav1[box_check[0]] = [max_x0, max_x0, max_v0, max_v0]
# center_times_uav1[box_check[1]] = [0, 4, 0, 0]
# radius_times_uav1[box_check[1]] = [3, 3, max_v, max_v]
center_times_uav1[box_check[1]] = [5, 4, 0, 0]
radius_times_uav1[box_check[1]] = [5, 5, 1, 1]

center_times_uav2[box_check[0]] = [-5, -5, 0, 0]
radius_times_uav2[box_check[0]] = [max_x0, max_x0, max_v0, max_v0]
# center_times_uav2[box_check[1]] = [0, -5, 0, 0]
# radius_times_uav2[box_check[1]] = [3, 3, max_v, max_v]
center_times_uav2[box_check[1]] = [5, -4, 0, 0]
radius_times_uav2[box_check[1]] = [1.5, 1.5, 1, 1]

center_times = [center_times_uav1[i] + center_times_uav2[i] for i in range(T + 1)]
radius_times = [radius_times_uav1[i] + radius_times_uav2[i] for i in range(T + 1)]

Poly_x = cart_H_cube(center_times, radius_times)


uav1_x_max = 1.2
uav1_y_max = 0.2
uav2_x_max = 4.0
uav2_y_max = 4.0
Poly_u = H_cube([0, 0, 0, 0],[uav1_x_max, uav1_y_max, uav2_x_max, uav2_y_max]).cartpower(T + 1)



wx_1_scale = 0.2
wy_1_scale = 0.4
wx_2_scale = 0.05
wy_2_scale = 0.05
wxdot_1_scale = 0.05
wydot_1_scale = 0.08
wxdot_2_scale = 0.05
wydot_2_scale = 0.05

v_scale = 0.05
delta = 0.01
RTH_opt_eps = 1e-11
sparse_opt_eps = 1e-10
rank_eps = 1e-7
N = 8

Poly_w = H_cube(center_times[0], radius_times[0]).cart(
    H_cube([0, 0, 0, 0, 0, 0, 0, 0], [wx_1_scale,wy_1_scale,wx_2_scale,wy_2_scale,wxdot_1_scale,wydot_1_scale,wxdot_2_scale,wydot_2_scale]).cartpower(T)
).cart(H_cube([0, 0, 0, 0], [v_scale] * 4).cartpower(T + 1))

# H_comm = np.array([
#     [ 1,  1,  0,  0, -1, -1,  0,  0],  # (x1 - x2) + (y1 - y2) <= comm_dist
#     [ 1, -1,  0,  0, -1,  1,  0,  0],
#     [-1,  1,  0,  0,  1, -1,  0,  0],
#     [-1, -1,  0,  0,  1,  1,  0,  0],
# ])
# h_comm = comm_dist * np.ones(4)
# Poly_comm_single = Polytope(H_comm, h_comm)
# Poly_comm = Poly_comm_single.cartpower(T + 1)

Poly_comm = partial_time_dist_poly([3,7], T, dist=5)
Poly_x = poly_intersect(Poly_x, Poly_comm)




test_feas = True
file = "simulation_results/simulationT10_joint.pickle"
save = True




























--- Baseline Communication Messages ----------------------------------------------------
Reweighted Nuclear Norm: 2.2051455661475927e-09
UAV2->UAV1 messages: 6
UAV1->UAV2 messages: 8
Message time in L21:
  Times (based on E rows): [0, 3, 3, 4, 6, 8]

Message time in L12:
  Times (based on E rows): [0, 3, 3, 3, 3, 7, 7, 8]

Message time in L21_Phiuy:
  Times (based on E rows): [0, 3, 3, 4, 6, 8]

Message time in L21_Phiux:
  Times (based on E rows): [0, 6, 6, 6, 6]

Message time in L21_Phixy:
  Times (based on E rows): [0, 3, 0, 4, 6, 8]

Message time in L12_Phiuy:
  Times (based on E rows): [0, 3, 3, 3, 3, 7, 7, 8]

Message time in L12_Phiux:
  Times (based on E rows): [0, 6, 6, 8, 12, 12, 16, 16]

Message time in L12_Phixy:
  Times (based on E rows): [0, 3, 3, 3, 3, 7, 3, 8]

saved to: baseline_results.npz

--- Offdiag Phi_uy Only -----------------------------------------------------
Com time: 169.8944787979126
Error truncated polytope constraint (Offdiag): 5.892772274584956e-07
rank K (offdiag): 34
band (D,E) = messages (offdiag): 34
Reweighted Nuclear Norm: 1.7554784295659154e-07
UAV2->UAV1 messages (offdiag): 12
UAV1->UAV2 messages (offdiag): 6
messages from rank: 12 6
Supposed Rank of L1 and L2:
Rank(L1), Rank(L2) in Phi_uy: 3 2
F, L21, L12 have been written to 'OffdiagMatrices.txt' for inspection.
Message time in L21:
  Times (based on E rows): [0, 1, 2, 4, 4, 4, 6, 6, 6, 8, 8, 8]

Message time in L12:
  Times (based on E rows): [0, 1, 2, 2, 6, 7]

Message time in L21_Phiuy:
  Times (based on E rows): [4, 6, 8]

Message time in L21_Phiux:
  Times (based on E rows): [0, 2, 4, 6, 8, 10, 12, 0, 14, 16, 18]

Message time in L21_Phixy:
  Times (based on E rows): [-1, 4, 4, 6, 6, 8]

Message time in L12_Phiuy:
  Times (based on E rows): [6, 7]

Message time in L12_Phiux:
  Times (based on E rows): [0, 2, 4, 6, 8, 10, 12, 12, 14, 16, 18]

Message time in L12_Phixy:
  Times (based on E rows): [-1, -1, -1, 6, 7, 7]

saved to: SLS_offdiag_results.npz

--- Offdiag Communication diagI ------------------------------------
Com time diagI: 646.6366617679596
Reweighted Nuclear Norm: 4.9011270208954016e-08
UAV2->UAV1 messages diagI: 6
UAV1->UAV2 messages diagI: 3
Supposed Rank of L1 and L2:
Rank(L1), Rank(L2) in Phi_uy: 6 3
Message time in L21:
  Times (based on E rows): [3, 4, 5, 6, 7, 8]

Message time in L12:
  Times (based on E rows): [0, 6, 7]

Message time in L21_Phiuy:
  Times (based on E rows): [3, 4, 5, 6, 7, 8]

Message time in L21_Phiux:
  Times (based on E rows): []

Message time in L21_Phixy:
  Times (based on E rows): [3, 4, 5, 6, 7, 8]

Message time in L12_Phiuy:
  Times (based on E rows): [0, 6, 7]

Message time in L12_Phiux:
  Times (based on E rows): []

Message time in L12_Phixy:
  Times (based on E rows): [0, 6, 7]

saved to: SLS_offdiag_diagI_results.npz

--- Offdiag Communication diagI ------------------------------------
Com time diagI: 1449.9535694122314
Reweighted Nuclear Norm: 5.200129330612535e-08
UAV2->UAV1 messages diagI: 3
UAV1->UAV2 messages diagI: 2
Supposed Rank of L1 and L2:
Rank(L1), Rank(L2) in Phi_uy: 3 2
Message time in L21:
  Times (based on E rows): [4, 6, 8]

Message time in L12:
  Times (based on E rows): [7, 8]

Message time in L21_Phiuy:
  Times (based on E rows): [4, 6, 8]

Message time in L21_Phiux:
  Times (based on E rows): []

Message time in L21_Phixy:
  Times (based on E rows): [4, 6, 8]

Message time in L12_Phiuy:

Message time in L12_Phiux:
  Times (based on E rows): []

Message time in L12_Phixy:
  Times (based on E rows): [7, 8]

saved to: SLS_offdiag_three_Phi_results.npz
PS D:\sparks\Study\Research\2025-control\lowRankControl-main>













--- Baseline Communication Messages ----------------------------------------------------
Reweighted Nuclear Norm: 2.2051455661475927e-09
UAV2->UAV1 messages: 6
UAV1->UAV2 messages: 8
Message time in L21:
  Adjusted Times: [0, 3, 4, 4, 6, 8]

Message time in L12:
  Adjusted Times: [0, 3, 3, 4, 5, 7, 7, 8]

Message time in L21_Phiuy:
  Adjusted Times: [0, 3, 4, 4, 6, 8]

Message time in L21_Phiux:
  Adjusted Times: [0, 3, 4, 5, 9]

Message time in L21_Phixy:
  Adjusted Times: [1, 4, 5, 5, 7, 9]

Message time in L12_Phiuy:
  Adjusted Times: [0, 3, 3, 4, 5, 7, 7, 8]

Message time in L12_Phiux:
  Adjusted Times: [0, 3, 3, 4, 6, 7, 8, 8]

Message time in L12_Phixy:
  Adjusted Times: [1, 4, 4, 5, 6, 8, 8, 9]

Saved to: baseline_results.npz

--- Optimize Offdiag Phi_uy Only -----------------------------------------------------
Com time: 152.6310534477234
Error truncated polytope constraint (Offdiag): 5.892772274584956e-07
rank K (offdiag): 34
band (D,E) = messages (offdiag): 34
Reweighted Nuclear Norm: 1.7554784295659154e-07
UAV2->UAV1 messages (offdiag): 12
UAV1->UAV2 messages (offdiag): 6
messages from rank: 12 6
Supposed Rank of L1 and L2:
Rank(L1), Rank(L2) in Phi_uy: 3 2
F, L21, L12 have been written to 'OffdiagMatrices.txt' for inspection.
Message time in L21:
  Adjusted Times: [1, 2, 3, 4, 4, 5, 6, 6, 7, 8, 8, 9]

Message time in L12:
  Adjusted Times: [1, 2, 3, 4, 6, 7]

Message time in L21_Phiuy:
  Adjusted Times: [4, 6, 8]

Message time in L21_Phiux:
  Adjusted Times: [0, 1, 2, 3, 4, 5, 6, 6, 7, 8, 9]

Message time in L21_Phixy:
  Adjusted Times: [3, 5, 6, 7, 8, 9]

Message time in L12_Phiuy:
  Adjusted Times: [6, 7]

Message time in L12_Phiux:
  Adjusted Times: [0, 1, 2, 3, 4, 5, 6, 6, 7, 8, 9]

Message time in L12_Phixy:
  Adjusted Times: [3, 4, 5, 7, 8, 9]

Saved to: SLS_offdiag_results.npz

---Optimize Offdiag Communication with Phi_xx constraint ------------------------------------
Com time diagI: 611.1578917503357
Reweighted Nuclear Norm: 4.9011270208954016e-08
UAV2->UAV1 messages diagI: 6
UAV1->UAV2 messages diagI: 3
Supposed Rank of L1 and L2:
Rank(L1), Rank(L2) in Phi_uy: 6 3
Message time in L21:
  Adjusted Times: [3, 4, 5, 6, 7, 8]

Message time in L12:
  Adjusted Times: [0, 6, 7]

Message time in L21_Phiuy:
  Adjusted Times: [3, 4, 5, 6, 7, 8]

Message time in L21_Phiux:
  Adjusted Times: []

Message time in L21_Phixy:
  Adjusted Times: [4, 5, 6, 7, 8, 9]

Message time in L12_Phiuy:
  Adjusted Times: [0, 6, 7]

Message time in L12_Phiux:
  Adjusted Times: []

Message time in L12_Phixy:
  Adjusted Times: [1, 7, 8]

Saved to: SLS_offdiag_diagI_results.npz

---Optimize Offdiag Communication three Phi with xx constrained ------------------------------------
Com time diagI: 1427.5746076107025
Reweighted Nuclear Norm: 5.200129330612535e-08
UAV2->UAV1 messages diagI: 3
UAV1->UAV2 messages diagI: 2
Supposed Rank of L1 and L2:
Rank(L1), Rank(L2) in Phi_uy: 3 2
Message time in L21:
  Adjusted Times: [4, 6, 8]

Message time in L12:
  Adjusted Times: [7, 8]

Message time in L21_Phiuy:
  Adjusted Times: [4, 6, 8]

Message time in L21_Phiux:
  Adjusted Times: []

Message time in L21_Phixy:
  Adjusted Times: [5, 7, 9]

Message time in L12_Phiuy:
  Adjusted Times: [7, 8]

Message time in L12_Phiux:
  Adjusted Times: []

Message time in L12_Phixy:
  Adjusted Times: [8, 9]

Saved to: SLS_offdiag_three_Phi_results.npz